{"version":3,"sources":["assets/scripts/camera/CameraTransposer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class CameraTransposer extends cc.Component {\n\n    @property(cc.Node)\n    followTarget: cc.Node = null;\n    @property(cc.Boolean)\n    followX: boolean = true;\n    @property(cc.Boolean)\n    followY: boolean = true;\n    // @property(cc.Float)\n    minX: number = -2147483647;\n    // @property(cc.Float)\n    minY: number = -2147483647;\n    // @property(cc.Float)\n    maxX: number = 2147483647;\n    // @property(cc.Float)\n    maxY: number = 2147483647;\n    // @property(cc.Float)\n    offsetX: number = 0;\n    // @property(cc.Float)\n    offsetY: number = 0;\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        \n    }\n\n    start () {\n        \n    }\n\n    update(dt) {\n        // Not using convertToWorldSpaceAR + convertToNodeSpaceAR because\n        // they are inaccurate and causes camera jitter. :(\n        let cameraLocalTransform = cc.mat4();\n        this.node.getLocalMatrix(cameraLocalTransform);\n        let targetWorldTransform = cc.mat4();\n        this.followTarget.getWorldMatrix(targetWorldTransform);\n        let targetWorldTranslation = cc.v3(0, 0, 0);\n        targetWorldTransform.getTranslation(targetWorldTranslation);\n        let transformed = cc.v4(targetWorldTranslation.x, targetWorldTranslation.y, targetWorldTranslation.z).transformMat4(cameraLocalTransform);\n        let targetPosition = cc.v2(transformed.x, transformed.y).add(cc.v2(-cc.view.getDesignResolutionSize().width / 2, -cc.view.getDesignResolutionSize().height / 2));\n        targetPosition = cc.v2(\n            clamp(this.followX ? targetPosition.x : this.node.position.x, this.minX, this.maxX),\n            clamp(this.followY ? targetPosition.y : this.node.position.y, this.minY, this.maxY)\n        );\n        this.node.position = targetPosition;\n    }\n}\n\nfunction clamp(x: number, a: number, b: number) {\n    if (x < a) return a;\n    if (x > b) return b;\n    return x;\n}"]}