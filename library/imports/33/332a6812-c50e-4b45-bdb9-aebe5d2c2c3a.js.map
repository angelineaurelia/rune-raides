{"version":3,"sources":["assets\\scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Player.ts\r\n\r\nconst { ccclass, property } = cc._decorator;\r\nimport GameManager from \"./GameManager\";\r\nimport BlueSlimeAI from \"./ai/BlueSlimeAI\";\r\n\r\ntype FacingDirection = \"up\" | \"down\" | \"left\" | \"right\";\r\n\r\n@ccclass\r\nexport default class Player extends cc.Component {\r\n    @property({ type: cc.Integer, tooltip: \"最大血量\" })\r\n    maxHp: number = 40;\r\n\r\n    @property({ type: cc.Integer, tooltip: \"攻擊力\" })\r\n    attackPower: number = 5;\r\n\r\n    @property({ type: cc.Integer, tooltip: \"初始血量\" })\r\n    hp: number = 40;\r\n\r\n    @property(cc.Node)\r\n    private lifebar: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    controller: cc.Node = null;\r\n\r\n    @property(cc.AudioClip)\r\n    attack1sound: cc.AudioClip = null;\r\n\r\n    @property(cc.AudioClip)\r\n    attack2sound: cc.AudioClip = null;\r\n\r\n    @property(cc.AudioClip)\r\n    attack3sound: cc.AudioClip = null;\r\n\r\n    @property(cc.AudioClip)\r\n    hurtsound: cc.AudioClip = null;\r\n\r\n    @property(cc.AudioClip)\r\n    healsound: cc.AudioClip = null;\r\n\r\n    @property(GameManager)\r\n    gameManager: GameManager = null;\r\n\r\n    public holdingKey: boolean = false;\r\n\r\n    /////////////////////////\r\n    // → NEW PROPERTIES ← //\r\n    /////////////////////////\r\n\r\n    // How far the player's attack reaches (in pixels, world-space)\r\n    @property({ type: cc.Integer, tooltip: \"Player attack range in pixels\" })\r\n    attackRange: number = 50;\r\n\r\n    // Delay (seconds) into the attack animation when damage is actually applied\r\n    @property({ type: cc.Float, tooltip: \"When (sec) to check hit in attack anim\" })\r\n    attackHitDelay: number = 0.2;\r\n\r\n    // Total length (seconds) of the attack animation\r\n    @property({ type: cc.Float, tooltip: \"Length of PlayerAttack animation\" })\r\n    attackAnimDuration: number = 0.5;\r\n\r\n    private isAttacking: boolean = false; // Prevent overlapping swings\r\n\r\n    /////////////////////////\r\n    // ← END NEW PROPS → //\r\n    /////////////////////////\r\n\r\n    private anim!: cc.Animation;\r\n\r\n    // Tracks which direction the player is facing.\r\n    // You should update this value whenever your movement code changes direction.\r\n    // Default is \"down\" if you don’t explicitly set it.\r\n    private facing: FacingDirection = \"down\";\r\n    private isDead: boolean = false;//new\r\n\r\n    onLoad() {\r\n        this.gameManager = cc.find(\"GameManager\").getComponent(\"GameManager\");\r\n        // Capture the Animation component once\r\n        this.anim = this.getComponent(cc.Animation)!;\r\n\r\n        // Listen for keyboard input to trigger attack\r\n        cc.systemEvent.on(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n    }\r\n\r\n    onDestroy() {\r\n        // Clean up listener\r\n        cc.systemEvent.off(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n    }\r\n\r\n    // Called when any key is pressed\r\n    private onKeyDown(event: cc.Event.EventKeyboard) {\r\n        // Use Space as the attack key (change if you prefer another key)\r\n        if (event.keyCode === cc.macro.KEY.c || event.keyCode === cc.macro.KEY.z || event.keyCode === cc.macro.KEY.v) {\r\n            this.tryAttack();\r\n        }\r\n    }\r\n\r\n    // Attempt to start an attack (if not already in one)\r\n    private tryAttack() {\r\n        if (this.isAttacking) return;\r\n        this.isAttacking = true;\r\n\r\n        // 1) Play attack animation & sound\r\n        if (this.anim) {\r\n            this.anim.play(\"PlayerAttack\"); // ensure you have a clip named “PlayerAttack”\r\n        }\r\n        if (this.attack1sound) {\r\n            cc.audioEngine.playEffect(this.attack1sound, false);\r\n        }\r\n\r\n        // 2) Schedule the actual “hit” moment\r\n        this.scheduleOnce(this.applyAttackHit, this.attackHitDelay);\r\n\r\n        // 3) Once the full animation is done, allow attacking again\r\n        this.scheduleOnce(() => {\r\n            this.isAttacking = false;\r\n        }, this.attackAnimDuration);\r\n    }\r\n\r\n    // Runs attackHitDelay seconds into the swing to check for any slimes in range\r\n    private applyAttackHit() {\r\n        // 1) Convert the player's position to world space (Vec3) and then to Vec2\r\n        const playerWorld3 = this.node.convertToWorldSpaceAR(cc.v3(0, 0, 0));\r\n        const playerWorld2 = cc.v2(playerWorld3.x, playerWorld3.y);\r\n\r\n        // 2) Find all slimes under “Canvas/MapManager/Actors”\r\n        const actorsRoot = cc.find(\"Canvas/MapManager/MonsterManager\");\r\n        if (!actorsRoot) return;\r\n\r\n        actorsRoot.children.forEach((childNode) => {\r\n            const slimeComp = childNode.getComponent(BlueSlimeAI);\r\n            if (!slimeComp) return; // skip non‐slime nodes\r\n\r\n            // 3) Convert that slime’s position to world-space Vec2\r\n            const slimeWorld3 = childNode.convertToWorldSpaceAR(cc.v3(0, 0, 0));\r\n            const slimeWorld2 = cc.v2(slimeWorld3.x, slimeWorld3.y);\r\n\r\n            // 4) Distance check\r\n            const dist = playerWorld2.sub(slimeWorld2).mag();\r\n            if (dist <= this.attackRange) {\r\n                // 5) Slash hits this slime → deal damage\r\n                slimeComp.takeDamage(this.attackPower);\r\n                // (Optional) If you only want one slime per swing, uncomment:\r\n                // return;\r\n            }\r\n            \r\n        });\r\n    }\r\n\r\n    /////////////////////////\r\n    // ← EXISTING METHODS →//\r\n    /////////////////////////\r\n\r\n    public get worldPosition(): cc.Vec3 {\r\n        return this.node.convertToWorldSpaceAR(cc.v3(0, 0, 0));\r\n    }\r\n\r\n    public get localPosition(): cc.Vec3 {\r\n        return this.node.position;\r\n    }\r\n\r\n    public takeDamage(amount: number) {\r\n        this.hp -= amount;\r\n        if (this.hp < 0) this.hp = 0;\r\n\r\n        // 1) If still alive → play “hurt” animation in the correct direction\r\n        if (this.hp > 0) {\r\n            switch (this.facing) {\r\n                case \"up\":\r\n                    this.anim.play(\"hurt_up\");\r\n                    break;\r\n                case \"down\":\r\n                    this.anim.play(\"hurt_down\");\r\n                    break;\r\n                case \"left\":\r\n                    this.anim.play(\"hurt_left\");\r\n                    break;\r\n                case \"right\":\r\n                    this.anim.play(\"hurt_right\");\r\n                    break;\r\n                default:\r\n                    // fallback, just in case\r\n                    this.anim.play(`hurt_${this.facing}`);\r\n                    break;\r\n            }\r\n            this.updatelife(-amount, this.hp);\r\n\r\n            if (this.hurtsound) {\r\n                cc.audioEngine.playEffect(this.hurtsound, false);\r\n            }\r\n            return; // exit early, no death logic yet\r\n        }\r\n        \r\n        // 2) HP has dropped to zero → play “death” animation in the correct direction\r\n        switch (this.facing) {\r\n            case \"up\":\r\n                this.anim.play(\"death_up\");\r\n                break;\r\n            case \"down\":\r\n                this.anim.play(\"death_down\");\r\n                break;\r\n            case \"left\":\r\n                this.anim.play(\"death_left\");\r\n                break;\r\n            case \"right\":\r\n                this.anim.play(\"death_right\");\r\n                break;\r\n            default:\r\n                // fallback, just in case\r\n                this.anim.play(`death_${this.facing}`);\r\n                break;\r\n        }\r\n        this.updatelife(-amount, this.hp);\r\n\r\n        // (Optional) play a death sound here if you want\r\n        // if (this.deathsound) cc.audioEngine.playEffect(this.deathsound, false);\r\n        this.isDead = true;\r\n        // 3) Delay the actual “freeze/game-over” until after the death animation finishes.\r\n        //    Suppose each death clip is about 1.0 second long; adjust as needed.\r\n        this.scheduleOnce(() => {\r\n            this.die();\r\n        }, 1.0);\r\n    }\r\n\r\n\r\n    public heal(amount: number) {\r\n        this.hp += amount;\r\n        if (this.hp > this.maxHp) this.hp = this.maxHp;\r\n        this.updatelife(amount, this.hp);\r\n        this.playhealsound();\r\n    }\r\n\r\n    public attack(target: Player) {\r\n        target.takeDamage(this.attackPower);\r\n    }\r\n\r\n    public die() {\r\n        // Hand over to your game‐over/freeze logic\r\n        this.controller.getComponent(\"ActorController\").godie();\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n\r\n    updatelife(num: number, hp: number) {\r\n        this.lifebar.width = hp;\r\n        if (hp <= 10) this.lifebar.color = cc.Color.RED;\r\n        else if (hp <= 20) this.lifebar.color = cc.Color.ORANGE;\r\n        else this.lifebar.color = cc.Color.GREEN;\r\n    }\r\n\r\n    public playattack1sound() {\r\n        if (this.attack1sound) cc.audioEngine.playEffect(this.attack1sound, false);\r\n        else console.log(\"No attack1 sound\");\r\n    }\r\n\r\n    public playattack2sound() {\r\n        if (this.attack2sound) cc.audioEngine.playEffect(this.attack2sound, false);\r\n        else console.log(\"No attack2 sound\");\r\n    }\r\n\r\n    public playattack3sound() {\r\n        if (this.attack3sound) cc.audioEngine.playEffect(this.attack3sound, false);\r\n        else console.log(\"No attack3 sound\");\r\n    }\r\n\r\n    public playhurtsound() {\r\n        if (this.hurtsound) cc.audioEngine.playEffect(this.hurtsound, false);\r\n        else console.log(\"No hurtsound\");\r\n    }\r\n\r\n    public playhealsound() {\r\n        if (this.healsound) cc.audioEngine.playEffect(this.healsound, false);\r\n        else console.log(\"No healsound\");\r\n    }\r\n\r\n    public SetPlayer(level: number) {\r\n        // reset player position & HP\r\n        this.hp = this.maxHp;\r\n        this.updatelife(0, this.hp);\r\n        this.node.setPosition(20, 20);\r\n        this.holdingKey = false;\r\n    }\r\n\r\n    onBeginContact(contact, selfCollider, otherCollider) {\r\n        if (otherCollider.node.name == \"key\") {\r\n            this.holdingKey = true;\r\n            otherCollider.node.active = false;\r\n        }\r\n        if (otherCollider.node.name == \"lock\" && this.holdingKey) {\r\n            const temp = otherCollider.getComponent(\"NewClass\");\r\n            if (temp) {\r\n                temp.playAnim();\r\n            }\r\n            this.scheduleOnce(() => {\r\n                if (otherCollider.node) otherCollider.node.destroy();\r\n                this.gameManager.GoNextLevel();\r\n            }, 1.2);\r\n        }\r\n    }\r\n\r\n    onDisable() {\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n}\r\n"]}