{"version":3,"sources":["assets\\scripts\\Menu\\AuthManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// assets/scripts/AuthManager.ts\r\ndeclare const firebase: any;\r\nconst { ccclass, property } = cc._decorator;\r\n// Ensure Firebase is initialized before using it\r\ndeclare global {\r\n  interface Window {\r\n    _firebaseInited?: boolean;\r\n  }\r\n}\r\n@ccclass('AuthManager')\r\nexport default class AuthManager extends cc.Component {\r\n  // These get wired automatically by find() in onLoad()\r\n  usernameEB: cc.EditBox = null;\r\n  emailEB: cc.EditBox = null;\r\n  pwdEB: cc.EditBox = null;\r\n  saveBtn: cc.Button = null;\r\n  exitBtn: cc.Button = null;\r\n\r\n  private auth: any = null;\r\n\r\n  onLoad() {\r\n\r\n    this.usernameEB = cc.find(\"UserName\", this.node).getComponent(cc.EditBox);\r\n    this.emailEB    = cc.find(\"Email\", this.node).getComponent(cc.EditBox);\r\n    this.pwdEB      = cc.find(\"Password\", this.node).getComponent(cc.EditBox);\r\n\r\n    this.saveBtn = cc.find(\"Save\", this.node).getComponent(cc.Button);\r\n    this.exitBtn = cc.find(\"Exit\", this.node).getComponent(cc.Button);\r\n    this.saveBtn.node.on('click', this.onSaveClicked, this);\r\n    this.exitBtn.node.on('click', () => this.node.destroy(), this);\r\n\r\n    // 3) Initialize Firebase Auth\r\n    if (!window._firebaseInited) {\r\n      cc.error(\"Firebase not initialized! Make sure FirebaseInit is in your scene.\");\r\n    }\r\n    this.auth = firebase.auth();\r\n  }\r\n\r\n  private onSaveClicked() {\r\n    let isSigningUp = cc.find(\"Canvas/MenuMgr\").getComponent(\"MenuMgr\").isSigningUp;\r\n    if (isSigningUp) this.signup();\r\n    else this.login();\r\n    const username = this.usernameEB.string.trim();\r\n    const email    = this.emailEB.string.trim();\r\n    const password = this.pwdEB.string;\r\n\r\n    if (!email || !password || !username) {\r\n      cc.warn(\"All fields must be filled.\");\r\n      return;\r\n    }\r\n\r\n    // 4) Create user and set displayName\r\n   \r\n    this.auth\r\n      .createUserWithEmailAndPassword(email, password)\r\n      .then((userCred: any) => {\r\n        return userCred.user.updateProfile({ displayName: username });\r\n      })\r\n      .then(() => {\r\n        cc.log(text + \" succeeded:\", username);\r\n        this.showPopup(text + \" Successful\");\r\n      })\r\n      .catch((err: any) => {\r\n        cc.error(text + \" error:\", err.code, err.message);\r\n      });\r\n  }\r\n\r\n  private signup(){\r\n    const username = this.usernameEB.string.trim();\r\n    const email    = this.emailEB.string.trim();\r\n    const password = this.pwdEB.string;\r\n\r\n    if (!email || !password || !username) {\r\n      cc.warn(\"All fields must be filled.\");\r\n      return;\r\n    }\r\n\r\n    // 4) Create user and set displayName\r\n    this.auth\r\n      .createUserWithEmailAndPassword(email, password)\r\n      .then((userCred: any) => {\r\n        return userCred.user.updateProfile({ displayName: username });\r\n      })\r\n      .then(() => {\r\n        cc.log(\"Signup succeeded:\", username);\r\n        this.showPopup(\"Signup Successful\");\r\n      })\r\n      .catch((err: any) => {\r\n        cc.error(\"Signup error:\", err.code, err.message);\r\n        this.showPopup(\"\\nSignup Failed: \" + err.message);\r\n      });\r\n  }\r\n  private login(){\r\n    const username = this.usernameEB.string.trim();\r\n    const email    = this.emailEB.string.trim();\r\n    const password = this.pwdEB.string;\r\n\r\n    if (!email || !password || !username) {\r\n      cc.warn(\"All fields must be filled.\");\r\n      return;\r\n    }\r\n    this.auth.signInWithEmailAndPassword(email, password).then((userCred: any) => {\r\n      cc.log(\"Login succeeded:\", username);\r\n      this.showPopup(\"\\nLogin Successful\");\r\n    })\r\n    .catch((err: any) => {\r\n      cc.error(\"Login error:\", err.code, err.message);\r\n      this.showPopup(\"\\nLogin Failed: \" + err.message);\r\n    });\r\n  }\r\n\r\n  private showPopup(msg: string) {\r\n    // Load and instantiate SuccessPopup\r\n    cc.resources.load(\"prefabs/SuccessPopup\", cc.Prefab, (err, prefab: cc.Prefab) => {\r\n      if (err) {\r\n        cc.error(\"Failed to load SuccessPopup:\", err);\r\n        return;\r\n      }\r\n      const popupNode = cc.instantiate(prefab);\r\n      popupNode.setPosition(0, 0);\r\n      popupNode.zIndex = 2000;\r\n      cc.find(\"Canvas\").addChild(popupNode);\r\n\r\n      const popupComp = popupNode.getComponent(\"SuccessPopup\") as any;\r\n      popupComp.messageLabel.string = msg;\r\n\r\n      // When user clicks OK â†’ destroy signup UI\r\n      popupComp.onOk = () => {\r\n        this.node.destroy();\r\n      };\r\n    });\r\n  }\r\n}"]}