{"version":3,"sources":["assets/scripts/GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport LoadingManager from \"./Menu/LoadingManager\";\ndeclare const firebase: any;\n//for Firebase initialization\ndeclare global {\n    interface Window {\n        _firebaseInited?: boolean;\n    }\n}\n\n@ccclass\nexport default class GameManager extends cc.Component {\n    @property({ type: cc.AudioClip })\n    public bgm: cc.AudioClip = null;\n\n    @property(cc.AudioClip)\n    public endBgm: cc.AudioClip = null;\n\n    @property(cc.Label)\n    public LevelLabel: cc.Label = null;\n\n    private maxhp: number = 10;\n    private player: cc.Node = null;\n    public VolumnValue : number = null;\n    public Level: number = 1;\n    private _hasShownGameOver = false;\n\n    onLoad(){\n        let pauseBtnNode = cc.find(\"Canvas/Main Camera/UI/Pause\"); \n        if (pauseBtnNode) {\n            let PauseButton = new cc.Component.EventHandler();\n            PauseButton.target = this.node;\n            PauseButton.component = \"GameManager\";\n            PauseButton.handler = \"PauseGame\";\n            pauseBtnNode.getComponent(cc.Button).clickEvents.push(PauseButton);\n        } else {\n            cc.error(\"Pause 按鈕節點找不到，請檢查 Canvas/Main Camera/UI/Pause 是否存在！\");\n        }\n        // Initialize the level label\n        this.LevelLabel = cc.find(\"Canvas/Main Camera/UI/Level\").getComponent(cc.Label);\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \" + this.Level;\n        else cc.error(\"Level label not found\");\n\n        this.player = cc.find(\"Canvas/MapManager/Actors/Player\");\n\n        //assign blank space for next level\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.log(\"Is Firebase initialized?\", window._firebaseInited);\n\n        /*const firebaseConfig = {\n            apiKey: \"AIzaSyDFW4-emWdI1ghgZWWGp1wqoWvAvTwAqrQ\",\n            authDomain: \"rune-raids.firebaseapp.com\",\n            projectId: \"rune-raids\",\n            storageBucket: \"rune-raids.firebasestorage.app\",\n            messagingSenderId: \"530514360843\",\n            appId: \"1:530514360843:web:1cdda9d72bb4b52932250e\",\n            measurementId: \"G-B1C5FG1YSN\"\n        }\n\n        if (!window._firebaseInited) {\n            firebase.initializeApp(firebaseConfig);\n            window._firebaseInited = true;\n            cc.log(\"✅ Firebase initialized in GameManager.ts\");\n        } else {\n            cc.log(\"ℹ️ Firebase already initialized\");\n        };*/\n        \n    }\n\n    onDestroy() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    }\n\n    onKeyDown(event: cc.Event.EventKeyboard) {\n        if (event.keyCode === cc.macro.KEY.space) {\n            this.GoNextLevel();\n        }\n    }\n\n    start() {\n        cc.director.getCollisionManager().enabled = true;\n        \n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\n        if (savedVolumn!==null) this.VolumnValue = Number(savedVolumn);\n        else this.VolumnValue = 0.5;\n        cc.audioEngine.setEffectsVolume(this.VolumnValue);\n        cc.audioEngine.setMusicVolume(this.VolumnValue);\n        this.playMusic();\n        this.startGame();\n\n    }\n\n    PauseGame() {\n        console.log(\"Pause prefab load\");\n        //Pausesetting is a prefab\n        cc.resources.load(\"prefabs/PauseSetting\", cc.Prefab, (err, prefab) => {\n            if (err) {\n                cc.error(\"Failed to load PauseSetting prefab:\", err);\n                return;\n            }\n            \n            const PauseNode = cc.instantiate(prefab);\n            const Canvas = cc.find(\"Canvas\");\n            Canvas.addChild(PauseNode);\n            PauseNode.name = \"PauseSetting\";\n\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\n            if (cameraNode) {\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\n                PauseNode.setPosition(localPos);\n            } else {\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\n                PauseNode.setPosition(0, 0);\n            }\n\n            PauseNode.scaleX = 1;\n            PauseNode.scaleY = 1;\n            //Pause the game，停止鍵盤事件\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n            cc.director.getScheduler().setTimeScale(0);\n            cc.director.getPhysicsManager().enabled = false;\n            let Canvas = cc.find(\"Canvas\");\n            this.PauseAllAnimation(Canvas); \n            this.initPause();\n        })\n        console.log(\"Pause prefab load...\");\n\n    }\n    initPause() {\n        //Resume button\n        let ResumeButton = new cc.Component.EventHandler();\n        ResumeButton.target = this.node;\n        ResumeButton.component = \"GameManager\";\n        ResumeButton.handler = \"ResumeGame\";\n        cc.find(\"Canvas/PauseSetting/Resume\").getComponent(cc.Button).clickEvents.push(ResumeButton);\n        //Volumn slider\n        let VolumnSlider = cc.find(\"Canvas/PauseSetting/Volumn/VolumnSlider\").getComponent(cc.Slider);\n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\n        if (savedVolumn !== null) VolumnSlider.progress= Number(savedVolumn);\n        else VolumnSlider.progress = 0.5;\n        VolumnSlider.node.on('slide', this.onVolumnChange, this);\n        //Restart button\n        let RestartButton = new cc.Component.EventHandler();\n        RestartButton.target = this.node;\n        RestartButton.component = \"GameManager\";\n        RestartButton.handler = \"RestartGame\";\n        cc.find(\"Canvas/PauseSetting/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\n        //\n        let DescButton = new cc.Component.EventHandler();\n        DescButton.target = this.node;\n        DescButton.component = \"GameManager\";\n        DescButton.handler = \"showDesc\";\n        cc.find(\"Canvas/PauseSetting/How\").getComponent(cc.Button).clickEvents.push(DescButton);\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\n        Desc.active = false;\n        let ExitDescButton = new cc.Component.EventHandler();\n        ExitDescButton.target = this.node;\n        ExitDescButton.component = \"GameManager\";\n        ExitDescButton.handler = \"HideDesc\";\n        cc.find(\"Canvas/PauseSetting/Description/Exit\").getComponent(cc.Button).clickEvents.push(ExitDescButton);\n    }\n    HideDesc() {\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\n        Desc.active = false;\n    }\n    showDesc() {\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\n        Desc.active = true;\n    }\n    RestartGame() {//Restart the game => back to menu\n        cc.director.getScheduler().setTimeScale(1);\n        cc.director.getPhysicsManager().enabled = true;\n        let Canvas = cc.find(\"Canvas\");\n        this.ResumeAllAnimation(Canvas);    \n        cc.director.loadScene(\"Loading\", () => {\n            let loadingManager = cc.find(\"Canvas/LoadingManager\").getComponent(\"LoadingManager\");\n            loadingManager.startLoading(\"menu\");\n        });\n        //Destroy Pausetting node if it exists\n        //let PauseSettingNode = cc.find(\"Canvas/Pausetting\");\n        //if (PauseSettingNode) PauseSettingNode.destroy();\n        //else cc.error(\"PauseSetting node not found\");\n         \n    }\n    ResumeGame() {\n        let PauseSettingNode = cc.find(\"Canvas/PauseSetting\");\n        if (PauseSettingNode) PauseSettingNode.destroy();\n        else cc.error(\"PauseSetting node not found\");\n        //Resume the game\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.director.getScheduler().setTimeScale(1);\n        cc.director.getPhysicsManager().enabled = true;\n        let Canvas = cc.find(\"Canvas\");\n        this.ResumeAllAnimation(Canvas); \n    }\n    onVolumnChange(slider: cc.Slider){\n        cc.audioEngine.setMusicVolume(slider.progress); // 0~1\n        cc.audioEngine.setEffectsVolume(slider.progress);\n        this.VolumnValue = slider.progress;\n        cc.sys.localStorage.setItem(\"VolumnValue\", this.VolumnValue.toString());\n    }\n    PauseAllAnimation(node: cc.Node) {\n        let anims = node.getComponentsInChildren(cc.Animation);\n        for (let anim of anims) {\n            if (anim) anim.pause();\n            else  cc.error(\"Animation component not found on node:\", node.name);\n        }\n        let children = node.children;\n        for (let child of children) this.PauseAllAnimation(child);\n    }\n    ResumeAllAnimation(node: cc.Node) {\n        let anims = node.getComponentsInChildren(cc.Animation);\n        for (let anim of anims) {\n            if (anim) anim.resume();\n            else  cc.error(\"Animation component not found on node:\", node.name);\n        }\n        let children = node.children;\n        for (let child of children) this.ResumeAllAnimation(child);\n    }\n    playendBGM() {\n        if (this.endBgm) cc.audioEngine.playMusic(this.endBgm, true);\n        else cc.error(\"End BGM not assigned!\");\n    }\n\n    playMusic() {\n        if (this.bgm) cc.audioEngine.playMusic(this.bgm, true);\n        else cc.error(\"BGM not assigned!\");\n    }\n\n    pauseMusic() {\n        cc.audioEngine.pauseMusic();\n    }\n\n    resumeMusic() {\n        cc.audioEngine.resumeMusic();\n    }\n    public startGame(){\n        //Initialize the game state\n        this.Level = 1;\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \"+ this.Level;\n        else cc.error(\"Level Label not found\");\n        //set player position\n        this.player.getComponent(\"Player\").SetPlayer(this.Level);\n        //set Map\n        let GenMap = cc.find(\"GameManager\").getComponent(\"MapGenerator\");\n        GenMap.GeneratorMap();\n        //set monster\n        let MonsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\").getComponent(\"MonsterManager\");\n        MonsterMgr.SetMonster(this.Level);\n\n    }\n\n    public GoNextLevel() {\n        //close keyboard event\n\n        this.Level++;\n        this.saveProgress(this.Level);\n\n        if (this.LevelLabel) {\n            this.LevelLabel.string = \"Level: \" + this.Level;\n        } else {\n            cc.error(\"Level label not found\");\n        }\n        let trans = cc.resources.load(\"prefabs/NextLevel\", cc.Prefab, (err, prefab) => {\n            if (err) {\n                cc.error(\"Failed to load NextLevel prefab:\", err);\n                return;\n            }\n            const TRNode = cc.instantiate(prefab);\n            const Canvas = cc.find(\"Canvas\");\n            TRNode.name = \"TR\";\n            // Set the position of the transition node to the center of the canvas\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\n            if (cameraNode) {\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\n                TRNode.setPosition(localPos);\n            } else {\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\n                TRNode.setPosition(0, 0);\n            }\n                TRNode.scaleX = 1;\n                TRNode.scaleY = 1;\n                TRNode.zIndex = 10; // Ensure it's on top\n                Canvas.addChild(TRNode);\n                let label = TRNode.getChildByName(\"MessageLabel\").getComponent(cc.Label);\n                if (label) {\n                    label.string = \"\\nGo to Level \" + this.Level + \" !\";\n                } else {\n                    cc.error(\"MessageLabel not found\");\n                }\n            }\n\n        //destroy transition node after 2 seconds\n        this.scheduleOnce(() => {\n            const TRNode = cc.find(\"Canvas/TR\");\n            if (TRNode) {\n                TRNode.destroy();\n            }\n        }, 2);\n                \n        this.scheduleOnce(()=>{\n            const mapGen = cc.find(\"GameManager\")?.getComponent(\"MapGenerator\");\n            if (mapGen) {\n                mapGen.regenerateMap(this.Level);\n            } else {\n                cc.error(\"MapGenerator component not found\");\n            }\n        },1.5);\n\n        // reset player position\n        const playerComp = cc.find(\"Canvas/MapManager/Actors/Player\").getComponent(\"Player\");\n        if (playerComp) {\n            playerComp.SetPlayer(this.Level);\n        } else {\n            cc.error(\"Player component not found\");\n        }\n\n        // reset monster\n        const monsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\")?.getComponent(\"MonsterManager\");\n        if (monsterMgr) {\n            monsterMgr.SetMonster(this.Level);\n        }\n\n        // adjust camera zoom and UI scaling\n        const camera = cc.find(\"Canvas/Main Camera\")?.getComponent(cc.Camera);\n        if (camera) {\n            camera.zoomRatio *= 0.99;\n\n            const UI = cc.find(\"Canvas/Main Camera/UI\");\n            if (UI) {\n                UI.setPosition(0, 0);\n                UI.scaleX = 1 / camera.zoomRatio;\n                UI.scaleY = 1 / camera.zoomRatio;\n            } else {\n                cc.log(\"UI not found\");\n            }\n        }\n        \n    }\n    public EndGame() {\n        if (this._hasShownGameOver) return;\n        this._hasShownGameOver = true;\n        this.playendBGM();\n        cc.resources.load(\"prefabs/GameOver\", cc.Prefab, (err, prefab) => {\n            if (err) {\n                cc.error(\"Failed to load GameOver prefab:\", err);\n                return;\n            }\n            const GameOverNode = cc.instantiate(prefab);\n            const Canvas = cc.find(\"Canvas\");\n            Canvas.addChild(GameOverNode,1,'GameOver');\n            //視窗正中間\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\n            if (cameraNode) {\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\n                GameOverNode.setPosition(localPos);\n            } else {\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\n                GameOverNode.setPosition(0, 0);\n            }\n            let RestartButton = new cc.Component.EventHandler();\n        RestartButton.target = this.node;\n        RestartButton.component = \"GameManager\";\n        RestartButton.handler = \"RestartGame\";\n        cc.find(\"Canvas/GameOver/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\n\n        let end = cc.find(\"Canvas/GameOver/player\").getComponent(cc.Animation);\n        //game over animation\n        this.scheduleOnce(()=>{ \n            end.play(\"gameover\");\n        });\n        });\n        \n    }\n    private saveProgress(level: number) {\n        cc.log(\"Saving progress for level:\", level);\n\n        if (!window._firebaseInited) {\n            cc.warn(\"Firebase not initialized.\");\n            return;\n        }\n\n        const user = firebase.auth().currentUser;\n        if (!user) {\n            cc.warn(\"User not logged in.\");\n            return;\n        }\n\n        const userRef = firebase.database().ref(\"leaderboard/\" + user.uid);\n\n        userRef.once(\"value\").then((snapshot: any) => {\n            const existing = snapshot.val();\n            const previousLevel = existing?.highestLevel || 0;\n\n            if (level > previousLevel) {\n            userRef.set({\n                username: user.displayName || \"Unknown\",\n                highestLevel: level,\n                lastUpdate: firebase.database.ServerValue.TIMESTAMP\n            }).then(() => {\n                cc.log(`✅ Updated Realtime DB for ${user.displayName || \"Unknown\"}: Level ${level}`);\n            }).catch((err: any) => {\n                cc.error(\"❌ Failed to write to Realtime DB:\", err);\n            });\n            } else {\n            cc.log(\"No update needed — previous level is higher or equal.\");\n            }\n        }).catch((err: any) => {\n            cc.error(\"❌ Failed to read from Realtime DB:\", err);\n        });\n    }\n\n    public loadLeaderboard() {\n        const dbRef = firebase.database().ref(\"leaderboard\");\n        dbRef.once(\"value\")\n            .then((snapshot: any) => {\n            const data = snapshot.val();\n            if (!data) {\n                cc.log(\"Leaderboard is empty.\");\n                return;\n            }\n\n            const sorted = Object.values(data)\n                .sort((a: any, b: any) => b.highestLevel - a.highestLevel)\n                .slice(0, 10);\n\n            sorted.forEach((entry: any, index: number) => {\n                cc.log(`#${index + 1} ${entry.username}: Level ${entry.highestLevel}`);\n            });\n            })\n            .catch((err: any) => {\n            cc.error(\"❌ Failed to load leaderboard from Realtime DB:\", err);\n            });\n    }\n}"]}