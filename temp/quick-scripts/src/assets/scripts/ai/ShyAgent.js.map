{"version":3,"sources":["assets\\scripts\\ai\\ShyAgent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { ButtonState, IInputControls } from \"../input/IInputControls\";\r\nimport Agent from \"./Agent\";\r\nimport { Coward } from \"./strategies/Coward\";\r\nimport { Wanderer } from \"./strategies/Wanderer\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n/**\r\n * Mixes two vectors.\r\n * \r\n * Example: `mixVec2(a, b, 0.25)` (Mathematically equivalent to a * 0.25 + b * 0.75)\r\n * @param mix A value between 0 and 1.\r\n * @returns The mixed result.\r\n */\r\nfunction mixVec2(a: cc.Vec2, b: cc.Vec2, mix: number) {\r\n    return a.mul(mix).add(b.mul(1.0 - mix))\r\n}\r\n\r\n@ccclass\r\nexport default class ShyAgent\r\n    extends Agent\r\n    implements IInputControls {\r\n    /** The agent will move for this long before stopping to wait. */\r\n    @property(cc.Float)\r\n    moveDuration = 1.0;\r\n    /** The agent will move at this speed. */\r\n    @property(cc.Float)\r\n    moveSpeed = 1.0;\r\n    /** The agent will wait for this long before starting to move again. */\r\n    @property(cc.Float)\r\n    waitDuration = 0.5;\r\n    /** The actual wait duration will be randomized by this factor, \r\n     *  such that the actual wait duration is a random number between\r\n     *  waitDuration x (1 - waitRandomFactor) and \r\n     *  waitDuration x (1 + waitRandomFactor).\r\n    */\r\n    @property(cc.Float)\r\n    waitRandomFactor = 0.1;\r\n    @property(cc.Node)\r\n    runAwayFrom: cc.Node = null;\r\n    @property(cc.Float)\r\n    safeDistance: number = 5.0;\r\n\r\n    public get horizontalAxis() { return this._moveAxis2D.x }\r\n    public get verticalAxis() { return this._moveAxis2D.y }\r\n    attack: ButtonState = ButtonState.Rest;\r\n    interact: ButtonState = ButtonState.Rest;\r\n\r\n    private _moveAxis2D: cc.Vec2 = cc.Vec2.ZERO;\r\n    private _wanderer: Wanderer = null;\r\n    private _coward: Coward = null;\r\n    private _isWaiting: Boolean = false;\r\n\r\n    protected agentUpdate(dt: number): void {\r\n        //*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*\\\\\r\n        // TODO (3.2): Combine the two strategies to implement ShyAgent's behaviour.\r\n        // [SPECIFICATIONS]\r\n        // - The ShyAgent is like the WanderAgent, but when it is about to move,\r\n        //   there are two cases:\r\n        //    - If the agent's distance to the target (runAwayFrom) is less than \r\n        //      the safe distance (safeDistance), set this._moveAxis2D as a mix of \r\n        //      the wanderer's axes and the coward's axes. \r\n        //      Please use the provided function mixVec2 with \r\n        //      a = wandererMove, b = cowardMove, mix = 0.25. (See line 25)\r\n        //    - Otherwise, set this.moveAxis2D as the wanderer's axes.\r\n        // - Note that the agent should NOT be able to change direction while moving.\r\n        //\r\n        // - Hint 1: You can use this._coward.distanceFromTarget to get the \r\n        //   distance to the target.\r\n        // - Hint 2: Try maintaining this.isWaiting to prevent the agent from\r\n        //   changing direction while moving.\r\n        //*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*\\\\\r\n        if (!this._wanderer || !this._coward) return;\r\n        //#region [YOUR IMPLEMENTATION HERE]\r\n        // ...\r\n        this._wanderer.update(dt);\r\n        this._coward.update(dt);\r\n        //#endregion\r\n        let wandererMove = cc.v2(this._wanderer.horizontalAxis, this._wanderer.verticalAxis);\r\n        let cowardMove = cc.v2(this._coward.horizontalAxis, this._coward.verticalAxis);\r\n        if (wandererMove.fuzzyEquals(cc.Vec2.ZERO, 0.01)) {\r\n            // Wanderer has stopped. The agent should move the moment it is no longer stopped.\r\n            this._isWaiting = true;\r\n            this._moveAxis2D = wandererMove;\r\n        }\r\n        //#region [YOUR IMPLEMENTATION HERE]\r\n        // ...\r\n        // else if (this._iswaiting) ...\r\n        else if (this._isWaiting) {\r\n            if (this._coward.distanceFromTarget < this.safeDistance) {\r\n                this._moveAxis2D = mixVec2(wandererMove, cowardMove, 0.25);\r\n            } else {\r\n                this._moveAxis2D = wandererMove;\r\n            }\r\n            this._isWaiting = false;\r\n        }\r\n        //#endregion\r\n    }\r\n\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    //*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*\\\\\r\n    // TODO (3.1): Initialize ShyAgent's two strategies (this.wanderer and this.coward) correctly.\r\n    // [SPECIFICATIONS]\r\n    // - You'll need ShyAgent's properties: moveDuration, waitDuration, \r\n    //   waitRandomFactor, runAwayFrom.\r\n    // - You'll also need to pass a reference to this object to the Coward strategy. \r\n    //   to construct it correctly. (How?)\r\n    //*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*\\\\\r\n    onLoad() {\r\n        //#region [YOUR IMPLEMENTATION HERE]\r\n        this._wanderer = new Wanderer(this.moveDuration, this.waitDuration, this.waitRandomFactor);\r\n        this._coward = new Coward(this, this.runAwayFrom);\r\n        //#endregion\r\n    }\r\n\r\n    start() {\r\n        //#region [YOUR IMPLEMENTATION HERE]\r\n        this._wanderer.start();\r\n        this._coward.start();\r\n        //#endregion\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}