<<<<<<< HEAD
{"version":3,"sources":["assets\\scripts\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport LoadingManager from \"./Menu/LoadingManager\";\r\nimport firebase from \"firebase/app\";\r\ndeclare const firebase: any;\r\n//for Firebase initialization\r\ndeclare global {\r\n    interface Window {\r\n        _firebaseInited?: boolean;\r\n    }\r\n}\r\n\r\n@ccclass\r\nexport default class GameManager extends cc.Component {\r\n    @property({ type: cc.AudioClip })\r\n    public bgm: cc.AudioClip = null;\r\n\r\n    @property(cc.Label)\r\n    public LevelLabel: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    public usernameLabel: cc.Label = null;\r\n\r\n    private maxhp: number = 10;\r\n    private player: cc.Node = null;\r\n    public VolumnValue : number = null;\r\n    public Level: number = 1;\r\n\r\n    onLoad(){\r\n        let pauseBtnNode = cc.find(\"Canvas/Main Camera/UI/Pause\"); \r\n        if (pauseBtnNode) {\r\n            let PauseButton = new cc.Component.EventHandler();\r\n            PauseButton.target = this.node;\r\n            PauseButton.component = \"GameManager\";\r\n            PauseButton.handler = \"PauseGame\";\r\n            pauseBtnNode.getComponent(cc.Button).clickEvents.push(PauseButton);\r\n        } else {\r\n            cc.error(\"Pause 按鈕節點找不到，請檢查 Canvas/Main Camera/UI/Pause 是否存在！\");\r\n        }\r\n        // Initialize the level label\r\n        this.LevelLabel = cc.find(\"Canvas/Main Camera/UI/Level\").getComponent(cc.Label);\r\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \" + this.Level;\r\n        else cc.error(\"Level label not found\");\r\n\r\n        this.player = cc.find(\"Canvas/MapManager/Actors/Player\");\r\n\r\n        //assign blank space for next level\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.log(\"Is Firebase initialized?\", window._firebaseInited);\r\n\r\n        /*const firebaseConfig = {\r\n            apiKey: \"AIzaSyDFW4-emWdI1ghgZWWGp1wqoWvAvTwAqrQ\",\r\n            authDomain: \"rune-raids.firebaseapp.com\",\r\n            projectId: \"rune-raids\",\r\n            storageBucket: \"rune-raids.firebasestorage.app\",\r\n            messagingSenderId: \"530514360843\",\r\n            appId: \"1:530514360843:web:1cdda9d72bb4b52932250e\",\r\n            measurementId: \"G-B1C5FG1YSN\"\r\n        };*/\r\n\r\n        if (!window._firebaseInited) {\r\n            firebase.initializeApp(firebaseConfig);\r\n            window._firebaseInited = true;\r\n            cc.log(\"✅ Firebase initialized in GameManager.ts\");\r\n        } else {\r\n            cc.log(\"ℹ️ Firebase already initialized\");\r\n        }\r\n        //firebase 取得username\r\n        const user = firebase.auth().currentUser;\r\n        if (user) {\r\n            this.usernameLabel.string = user.displayName || \"Guest\";\r\n            console.log(\"User logged in:\", user.displayName);\r\n        } else console.log(\"User not logged in\");\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        if (event.keyCode === cc.macro.KEY.space) {\r\n            this.GoNextLevel();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        cc.director.getCollisionManager().enabled = true;\r\n        \r\n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\r\n        if (savedVolumn!==null) this.VolumnValue = Number(savedVolumn);\r\n        else this.VolumnValue = 0.5;\r\n        cc.audioEngine.setEffectsVolume(this.VolumnValue);\r\n        cc.audioEngine.setMusicVolume(this.VolumnValue);\r\n        this.playMusic();\r\n        this.startGame();\r\n\r\n    }\r\n\r\n    PauseGame() {\r\n        console.log(\"Pause prefab load\");\r\n        //Pausesetting is a prefab\r\n        cc.resources.load(\"prefabs/PauseSetting\", cc.Prefab, (err, prefab) => {\r\n            if (err) {\r\n                cc.error(\"Failed to load PauseSetting prefab:\", err);\r\n                return;\r\n            }\r\n            \r\n            const PauseNode = cc.instantiate(prefab);\r\n            const Canvas = cc.find(\"Canvas\");\r\n            Canvas.addChild(PauseNode);\r\n            PauseNode.name = \"PauseSetting\";\r\n\r\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\r\n            if (cameraNode) {\r\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\r\n                PauseNode.setPosition(localPos);\r\n            } else {\r\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\r\n                PauseNode.setPosition(0, 0);\r\n            }\r\n\r\n            PauseNode.scaleX = 1;\r\n            PauseNode.scaleY = 1;\r\n            //Pause the game，停止鍵盤事件\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            cc.director.getScheduler().setTimeScale(0);\r\n            cc.director.getPhysicsManager().enabled = false;\r\n            let Canvas = cc.find(\"Canvas\");\r\n            this.PauseAllAnimation(Canvas); \r\n            this.initPause();\r\n        })\r\n        console.log(\"Pause prefab load...\");\r\n\r\n    }\r\n    initPause() {\r\n        //Resume button\r\n        let ResumeButton = new cc.Component.EventHandler();\r\n        ResumeButton.target = this.node;\r\n        ResumeButton.component = \"GameManager\";\r\n        ResumeButton.handler = \"ResumeGame\";\r\n        cc.find(\"Canvas/PauseSetting/Resume\").getComponent(cc.Button).clickEvents.push(ResumeButton);\r\n        //Volumn slider\r\n        let VolumnSlider = cc.find(\"Canvas/PauseSetting/Volumn/VolumnSlider\").getComponent(cc.Slider);\r\n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\r\n        if (savedVolumn !== null) VolumnSlider.progress= Number(savedVolumn);\r\n        else VolumnSlider.progress = 0.5;\r\n        VolumnSlider.node.on('slide', this.onVolumnChange, this);\r\n        //Restart button\r\n        let RestartButton = new cc.Component.EventHandler();\r\n        RestartButton.target = this.node;\r\n        RestartButton.component = \"GameManager\";\r\n        RestartButton.handler = \"RestartGame\";\r\n        cc.find(\"Canvas/PauseSetting/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\r\n        //\r\n        let DescButton = new cc.Component.EventHandler();\r\n        DescButton.target = this.node;\r\n        DescButton.component = \"GameManager\";\r\n        DescButton.handler = \"showDesc\";\r\n        cc.find(\"Canvas/PauseSetting/How\").getComponent(cc.Button).clickEvents.push(DescButton);\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = false;\r\n        let ExitDescButton = new cc.Component.EventHandler();\r\n        ExitDescButton.target = this.node;\r\n        ExitDescButton.component = \"GameManager\";\r\n        ExitDescButton.handler = \"HideDesc\";\r\n        cc.find(\"Canvas/PauseSetting/Description/Exit\").getComponent(cc.Button).clickEvents.push(ExitDescButton);\r\n    }\r\n    HideDesc() {\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = false;\r\n    }\r\n    showDesc() {\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = true;\r\n    }\r\n    RestartGame() {//Restart the game => back to menu\r\n\r\n        cc.director.getScheduler().setTimeScale(1);\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        let Canvas = cc.find(\"Canvas\");\r\n        this.ResumeAllAnimation(Canvas);    \r\n        cc.director.loadScene(\"Loading\", () => {\r\n            let loadingManager = cc.find(\"Canvas/LoadingManager\").getComponent(\"LoadingManager\");\r\n            loadingManager.startLoading(\"menu\");\r\n        });\r\n        //Destroy Pausetting node if it exists\r\n        //let PauseSettingNode = cc.find(\"Canvas/Pausetting\");\r\n        //if (PauseSettingNode) PauseSettingNode.destroy();\r\n        //else cc.error(\"PauseSetting node not found\");\r\n         \r\n    }\r\n    ResumeGame() {\r\n        let PauseSettingNode = cc.find(\"Canvas/PauseSetting\");\r\n        if (PauseSettingNode) PauseSettingNode.destroy();\r\n        else cc.error(\"PauseSetting node not found\");\r\n        //Resume the game\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.director.getScheduler().setTimeScale(1);\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        let Canvas = cc.find(\"Canvas\");\r\n        this.ResumeAllAnimation(Canvas); \r\n    }\r\n    onVolumnChange(slider: cc.Slider){\r\n        cc.audioEngine.setMusicVolume(slider.progress); // 0~1\r\n        cc.audioEngine.setEffectsVolume(slider.progress);\r\n        this.VolumnValue = slider.progress;\r\n        cc.sys.localStorage.setItem(\"VolumnValue\", this.VolumnValue.toString());\r\n    }\r\n    PauseAllAnimation(node: cc.Node) {\r\n        let anims = node.getComponentsInChildren(cc.Animation);\r\n        for (let anim of anims) {\r\n            if (anim) anim.pause();\r\n            else  cc.error(\"Animation component not found on node:\", node.name);\r\n        }\r\n        let children = node.children;\r\n        for (let child of children) this.PauseAllAnimation(child);\r\n    }\r\n    ResumeAllAnimation(node: cc.Node) {\r\n        let anims = node.getComponentsInChildren(cc.Animation);\r\n        for (let anim of anims) {\r\n            if (anim) anim.resume();\r\n            else  cc.error(\"Animation component not found on node:\", node.name);\r\n        }\r\n        let children = node.children;\r\n        for (let child of children) this.ResumeAllAnimation(child);\r\n    }\r\n\r\n    playMusic() {\r\n        if (this.bgm) cc.audioEngine.playMusic(this.bgm, true);\r\n        else cc.error(\"BGM not assigned!\");\r\n    }\r\n\r\n    pauseMusic() {\r\n        cc.audioEngine.pauseMusic();\r\n    }\r\n\r\n    resumeMusic() {\r\n        cc.audioEngine.resumeMusic();\r\n    }\r\n    public startGame(){\r\n        //Initialize the game state\r\n        this.Level = 1;\r\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \"+ this.Level;\r\n        else cc.error(\"Level Label not found\");\r\n        //set player position\r\n        this.player.getComponent(\"Player\").SetPlayer(this.Level);\r\n        //set Map\r\n        let GenMap = cc.find(\"GameManager\").getComponent(\"MapGenerator\");\r\n        GenMap.GeneratorMap();\r\n        //set monster\r\n        let MonsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\").getComponent(\"MonsterManager\");\r\n        MonsterMgr.SetMonster(this.Level);\r\n\r\n    }\r\n\r\n    public GoNextLevel() {\r\n        this.Level++;\r\n        this.saveProgress(this.Level);\r\n\r\n        if (this.LevelLabel) {\r\n            this.LevelLabel.string = \"Level: \" + this.Level;\r\n        } else {\r\n            cc.error(\"Level label not found\");\r\n        }\r\n\r\n        // regenerate the map\r\n        const mapGen = cc.find(\"GameManager\")?.getComponent(\"MapGenerator\");\r\n        if (mapGen) {\r\n            mapGen.regenerateMap(this.Level);\r\n        } else {\r\n            cc.error(\"MapGenerator component not found\");\r\n        }\r\n\r\n        // reset player position\r\n        const playerComp = this.player?.getComponent(\"Player\");\r\n        if (playerComp) {\r\n            playerComp.SetPlayer(this.Level);\r\n        } else {\r\n            cc.error(\"Player component not found\");\r\n        }\r\n\r\n        // reset monster\r\n        const monsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\")?.getComponent(\"MonsterManager\");\r\n        if (monsterMgr) {\r\n            monsterMgr.SetMonster(this.Level);\r\n        }\r\n\r\n        // adjust camera zoom and UI scaling\r\n        const camera = cc.find(\"Canvas/Main Camera\")?.getComponent(cc.Camera);\r\n        if (camera) {\r\n            camera.zoomRatio *= 0.99;\r\n\r\n            const UI = cc.find(\"Canvas/Main Camera/UI\");\r\n            if (UI) {\r\n                UI.setPosition(0, 0);\r\n                UI.scaleX = 1 / camera.zoomRatio;\r\n                UI.scaleY = 1 / camera.zoomRatio;\r\n            } else {\r\n                cc.log(\"UI not found\");\r\n            }\r\n        }\r\n    }\r\n    public EndGame() {\r\n        cc.resources.load(\"prefabs/GameOver\", cc.Prefab, (err, prefab) => {\r\n            if (err) {\r\n                cc.error(\"Failed to load GameOver prefab:\", err);\r\n                return;\r\n            }\r\n            const GameOverNode = cc.instantiate(prefab);\r\n            const Canvas = cc.find(\"Canvas\");\r\n            Canvas.addChild(GameOverNode,1,'GameOver');\r\n            //視窗正中間\r\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\r\n            if (cameraNode) {\r\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\r\n                GameOverNode.setPosition(localPos);\r\n            } else {\r\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\r\n                GameOverNode.setPosition(0, 0);\r\n            }\r\n            let RestartButton = new cc.Component.EventHandler();\r\n        RestartButton.target = this.node;\r\n        RestartButton.component = \"GameManager\";\r\n        RestartButton.handler = \"RestartGame\";\r\n        cc.find(\"Canvas/GameOver/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\r\n\r\n        let end = cc.find(\"Canvas/GameOver/player\").getComponent(cc.Animation);\r\n        //game over animation\r\n        this.scheduleOnce(()=>{ \r\n            end.play(\"gameover\");\r\n        });\r\n        });\r\n        \r\n    }\r\n    private saveProgress(level: number) {\r\n        cc.log(\"Saving progress for level:\", level);\r\n\r\n        if (!window._firebaseInited) {\r\n            cc.warn(\"Firebase not initialized.\");\r\n            return;\r\n        }\r\n\r\n        const user = firebase.auth().currentUser;\r\n        if (!user) {\r\n            cc.warn(\"User not logged in.\");\r\n            return;\r\n        }\r\n\r\n        const userRef = firebase.database().ref(\"leaderboard/\" + user.uid);\r\n\r\n        userRef.once(\"value\").then((snapshot: any) => {\r\n            const existing = snapshot.val();\r\n            const previousLevel = existing?.highestLevel || 0;\r\n\r\n            if (level > previousLevel) {\r\n            userRef.set({\r\n                username: user.displayName || \"Unknown\",\r\n                highestLevel: level,\r\n                lastUpdate: firebase.database.ServerValue.TIMESTAMP\r\n            }).then(() => {\r\n                cc.log(`✅ Updated Realtime DB for ${user.displayName || \"Unknown\"}: Level ${level}`);\r\n            }).catch((err: any) => {\r\n                cc.error(\"❌ Failed to write to Realtime DB:\", err);\r\n            });\r\n            } else {\r\n            cc.log(\"No update needed — previous level is higher or equal.\");\r\n            }\r\n        }).catch((err: any) => {\r\n            cc.error(\"❌ Failed to read from Realtime DB:\", err);\r\n        });\r\n    }\r\n\r\n    public loadLeaderboard() {\r\n        const dbRef = firebase.database().ref(\"leaderboard\");\r\n        dbRef.once(\"value\")\r\n            .then((snapshot: any) => {\r\n            const data = snapshot.val();\r\n            if (!data) {\r\n                cc.log(\"Leaderboard is empty.\");\r\n                return;\r\n            }\r\n\r\n            const sorted = Object.values(data)\r\n                .sort((a: any, b: any) => b.highestLevel - a.highestLevel)\r\n                .slice(0, 10);\r\n\r\n            sorted.forEach((entry: any, index: number) => {\r\n                cc.log(`#${index + 1} ${entry.username}: Level ${entry.highestLevel}`);\r\n            });\r\n            })\r\n            .catch((err: any) => {\r\n            cc.error(\"❌ Failed to load leaderboard from Realtime DB:\", err);\r\n            });\r\n    }\r\n}"]}
=======
{"version":3,"sources":["assets\\scripts\\GameManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAW5C;IAAyC,+BAAY;IAArD;QAAA,qEAsXC;QApXU,SAAG,GAAiB,IAAI,CAAC;QAGzB,gBAAU,GAAa,IAAI,CAAC;QAE3B,WAAK,GAAW,EAAE,CAAC;QACnB,YAAM,GAAY,IAAI,CAAC;QACxB,iBAAW,GAAY,IAAI,CAAC;QAC5B,WAAK,GAAW,CAAC,CAAC;;IA4W7B,CAAC;IA1WG,4BAAM,GAAN;QACI,IAAI,YAAY,GAAG,EAAE,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;QAC1D,IAAI,YAAY,EAAE;YACd,IAAI,WAAW,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;YAClD,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;YAC/B,WAAW,CAAC,SAAS,GAAG,aAAa,CAAC;YACtC,WAAW,CAAC,OAAO,GAAG,WAAW,CAAC;YAClC,YAAY,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;SACtE;aAAM;YACH,EAAE,CAAC,KAAK,CAAC,qDAAqD,CAAC,CAAC;SACnE;QACD,6BAA6B;QAC7B,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;QAChF,IAAI,IAAI,CAAC,UAAU;YAAE,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC;;YAChE,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAEvC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QAEzD,mCAAmC;QACnC,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC3E,EAAE,CAAC,GAAG,CAAC,0BAA0B,EAAE,MAAM,CAAC,eAAe,CAAC,CAAC;QAE3D;;;;;;;;YAQI;QAEJ,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;YACzB,QAAQ,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;YACvC,MAAM,CAAC,eAAe,GAAG,IAAI,CAAC;YAC9B,EAAE,CAAC,GAAG,CAAC,0CAA0C,CAAC,CAAC;SACtD;aAAM;YACH,EAAE,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;SAC7C;IAEL,CAAC;IAED,+BAAS,GAAT;QACI,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAChF,CAAC;IAED,+BAAS,GAAT,UAAU,KAA6B;QACnC,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE;YACtC,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;IACL,CAAC;IAED,2BAAK,GAAL;QACI,EAAE,CAAC,QAAQ,CAAC,mBAAmB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAEjD,IAAI,WAAW,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QAC7D,IAAI,WAAW,KAAG,IAAI;YAAE,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC;;YAC1D,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC;QAC5B,EAAE,CAAC,WAAW,CAAC,gBAAgB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAClD,EAAE,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAChD,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,SAAS,EAAE,CAAC;IAErB,CAAC;IAED,+BAAS,GAAT;QAAA,iBAoCC;QAnCG,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QACjC,0BAA0B;QAC1B,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,GAAG,EAAE,MAAM;YAC7D,IAAI,GAAG,EAAE;gBACL,EAAE,CAAC,KAAK,CAAC,qCAAqC,EAAE,GAAG,CAAC,CAAC;gBACrD,OAAO;aACV;YAED,IAAM,SAAS,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACzC,IAAM,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;YAC3B,SAAS,CAAC,IAAI,GAAG,cAAc,CAAC;YAEhC,IAAI,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAC/C,IAAI,UAAU,EAAE;gBACZ,IAAI,QAAQ,GAAG,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC9D,IAAI,QAAQ,GAAG,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;gBACrD,SAAS,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;aACnC;iBAAM;gBACH,EAAE,CAAC,IAAI,CAAC,gCAAgC,CAAC,CAAC;gBAC1C,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAC/B;YAED,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;YACrB,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;YACrB,uBAAuB;YACvB,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAI,CAAC,SAAS,EAAE,KAAI,CAAC,CAAC;YAC5E,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,KAAK,CAAC;YAChD,IAAI,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/B,KAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;YAC/B,KAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC,CAAC,CAAA;QACF,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;IAExC,CAAC;IACD,+BAAS,GAAT;QACI,eAAe;QACf,IAAI,YAAY,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QACnD,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;QAChC,YAAY,CAAC,SAAS,GAAG,aAAa,CAAC;QACvC,YAAY,CAAC,OAAO,GAAG,YAAY,CAAC;QACpC,EAAE,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC7F,eAAe;QACf,IAAI,YAAY,GAAG,EAAE,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAC9F,IAAI,WAAW,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QAC7D,IAAI,WAAW,KAAK,IAAI;YAAE,YAAY,CAAC,QAAQ,GAAE,MAAM,CAAC,WAAW,CAAC,CAAC;;YAChE,YAAY,CAAC,QAAQ,GAAG,GAAG,CAAC;QACjC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QACzD,gBAAgB;QAChB,IAAI,aAAa,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QACpD,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;QACjC,aAAa,CAAC,SAAS,GAAG,aAAa,CAAC;QACxC,aAAa,CAAC,OAAO,GAAG,aAAa,CAAC;QACtC,EAAE,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC/F,EAAE;QACF,IAAI,UAAU,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QACjD,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;QAC9B,UAAU,CAAC,SAAS,GAAG,aAAa,CAAC;QACrC,UAAU,CAAC,OAAO,GAAG,UAAU,CAAC;QAChC,EAAE,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACxF,IAAI,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,cAAc,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QACrD,cAAc,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;QAClC,cAAc,CAAC,SAAS,GAAG,aAAa,CAAC;QACzC,cAAc,CAAC,OAAO,GAAG,UAAU,CAAC;QACpC,EAAE,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC7G,CAAC;IACD,8BAAQ,GAAR;QACI,IAAI,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IACD,8BAAQ,GAAR;QACI,IAAI,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IACD,iCAAW,GAAX;QACI,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAC3C,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,IAAI,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;QAChC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,EAAE;YAC7B,IAAI,cAAc,GAAG,EAAE,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC;YACrF,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QACH,sCAAsC;QACtC,sDAAsD;QACtD,mDAAmD;QACnD,+CAA+C;IAEnD,CAAC;IACD,gCAAU,GAAV;QACI,IAAI,gBAAgB,GAAG,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACtD,IAAI,gBAAgB;YAAE,gBAAgB,CAAC,OAAO,EAAE,CAAC;;YAC5C,EAAE,CAAC,KAAK,CAAC,6BAA6B,CAAC,CAAC;QAC7C,iBAAiB;QACjB,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC3E,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAC3C,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,IAAI,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC;IACD,oCAAc,GAAd,UAAe,MAAiB;QAC5B,EAAE,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM;QACtD,EAAE,CAAC,WAAW,CAAC,gBAAgB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACjD,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC;QACnC,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC5E,CAAC;IACD,uCAAiB,GAAjB,UAAkB,IAAa;QAC3B,IAAI,KAAK,GAAG,IAAI,CAAC,uBAAuB,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QACvD,KAAiB,UAAK,EAAL,eAAK,EAAL,mBAAK,EAAL,IAAK,EAAE;YAAnB,IAAI,IAAI,cAAA;YACT,IAAI,IAAI;gBAAE,IAAI,CAAC,KAAK,EAAE,CAAC;;gBACjB,EAAE,CAAC,KAAK,CAAC,wCAAwC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACvE;QACD,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC7B,KAAkB,UAAQ,EAAR,qBAAQ,EAAR,sBAAQ,EAAR,IAAQ;YAArB,IAAI,KAAK,iBAAA;YAAc,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;SAAA;IAC9D,CAAC;IACD,wCAAkB,GAAlB,UAAmB,IAAa;QAC5B,IAAI,KAAK,GAAG,IAAI,CAAC,uBAAuB,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QACvD,KAAiB,UAAK,EAAL,eAAK,EAAL,mBAAK,EAAL,IAAK,EAAE;YAAnB,IAAI,IAAI,cAAA;YACT,IAAI,IAAI;gBAAE,IAAI,CAAC,MAAM,EAAE,CAAC;;gBAClB,EAAE,CAAC,KAAK,CAAC,wCAAwC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACvE;QACD,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC7B,KAAkB,UAAQ,EAAR,qBAAQ,EAAR,sBAAQ,EAAR,IAAQ;YAArB,IAAI,KAAK,iBAAA;YAAc,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;SAAA;IAC/D,CAAC;IAED,+BAAS,GAAT;QACI,IAAI,IAAI,CAAC,GAAG;YAAE,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;;YAClD,EAAE,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;IACvC,CAAC;IAED,gCAAU,GAAV;QACI,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;IAChC,CAAC;IAED,iCAAW,GAAX;QACI,EAAE,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC;IACjC,CAAC;IACM,+BAAS,GAAhB;QACI,2BAA2B;QAC3B,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,IAAI,CAAC,UAAU;YAAE,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,SAAS,GAAE,IAAI,CAAC,KAAK,CAAC;;YAC/D,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QACvC,qBAAqB;QACrB,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACzD,SAAS;QACT,IAAI,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;QACjE,MAAM,CAAC,YAAY,EAAE,CAAC;QACtB,aAAa;QACb,IAAI,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC;QAC5F,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAEtC,CAAC;IAEM,iCAAW,GAAlB;;QACI,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAE9B,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC;SACnD;aAAM;YACH,EAAE,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;SACrC;QAED,qBAAqB;QACrB,IAAM,MAAM,SAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,0CAAE,YAAY,CAAC,cAAc,CAAC,CAAC;QACpE,IAAI,MAAM,EAAE;YACR,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACpC;aAAM;YACH,EAAE,CAAC,KAAK,CAAC,kCAAkC,CAAC,CAAC;SAChD;QAED,wBAAwB;QACxB,IAAM,UAAU,SAAG,IAAI,CAAC,MAAM,0CAAE,YAAY,CAAC,QAAQ,CAAC,CAAC;QACvD,IAAI,UAAU,EAAE;YACZ,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACpC;aAAM;YACH,EAAE,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;SAC1C;QAED,gBAAgB;QAChB,IAAM,UAAU,SAAG,EAAE,CAAC,IAAI,CAAC,kCAAkC,CAAC,0CAAE,YAAY,CAAC,gBAAgB,CAAC,CAAC;QAC/F,IAAI,UAAU,EAAE;YACZ,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACrC;QAED,oCAAoC;QACpC,IAAM,MAAM,SAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,0CAAE,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QACtE,IAAI,MAAM,EAAE;YACR,MAAM,CAAC,SAAS,IAAI,IAAI,CAAC;YAEzB,IAAM,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;YAC5C,IAAI,EAAE,EAAE;gBACJ,EAAE,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrB,EAAE,CAAC,MAAM,GAAG,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC;gBACjC,EAAE,CAAC,MAAM,GAAG,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC;aACpC;iBAAM;gBACH,EAAE,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;aAC1B;SACJ;IACL,CAAC;IACM,6BAAO,GAAd;QAAA,iBAgCC;QA/BG,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,GAAG,EAAE,MAAM;YACzD,IAAI,GAAG,EAAE;gBACL,EAAE,CAAC,KAAK,CAAC,iCAAiC,EAAE,GAAG,CAAC,CAAC;gBACjD,OAAO;aACV;YACD,IAAM,YAAY,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAC5C,IAAM,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjC,MAAM,CAAC,QAAQ,CAAC,YAAY,EAAC,CAAC,EAAC,UAAU,CAAC,CAAC;YAC3C,OAAO;YACP,IAAI,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAC/C,IAAI,UAAU,EAAE;gBACZ,IAAI,QAAQ,GAAG,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC9D,IAAI,QAAQ,GAAG,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;gBACrD,YAAY,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;aACtC;iBAAM;gBACH,EAAE,CAAC,IAAI,CAAC,gCAAgC,CAAC,CAAC;gBAC1C,YAAY,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAClC;YACD,IAAI,aAAa,GAAG,IAAI,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;YACxD,aAAa,CAAC,MAAM,GAAG,KAAI,CAAC,IAAI,CAAC;YACjC,aAAa,CAAC,SAAS,GAAG,aAAa,CAAC;YACxC,aAAa,CAAC,OAAO,GAAG,aAAa,CAAC;YACtC,EAAE,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAE3F,IAAI,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;YACvE,qBAAqB;YACrB,KAAI,CAAC,YAAY,CAAC;gBACd,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACzB,CAAC,CAAC,CAAC;QACH,CAAC,CAAC,CAAC;IAEP,CAAC;IACO,kCAAY,GAApB,UAAqB,KAAa;QAC9B,EAAE,CAAC,GAAG,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;QAE5C,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;YACzB,EAAE,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;YACrC,OAAO;SACV;QAED,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC;QACzC,IAAI,CAAC,IAAI,EAAE;YACP,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YAC/B,OAAO;SACV;QAED,IAAM,OAAO,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,cAAc,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;QAEnE,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAC,QAAa;YACrC,IAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAChC,IAAM,aAAa,GAAG,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,YAAY,KAAI,CAAC,CAAC;YAElD,IAAI,KAAK,GAAG,aAAa,EAAE;gBAC3B,OAAO,CAAC,GAAG,CAAC;oBACR,QAAQ,EAAE,IAAI,CAAC,WAAW,IAAI,SAAS;oBACvC,YAAY,EAAE,KAAK;oBACnB,UAAU,EAAE,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,SAAS;iBACtD,CAAC,CAAC,IAAI,CAAC;oBACJ,EAAE,CAAC,GAAG,CAAC,qCAA6B,IAAI,CAAC,WAAW,IAAI,SAAS,iBAAW,KAAO,CAAC,CAAC;gBACzF,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,GAAQ;oBACd,EAAE,CAAC,KAAK,CAAC,mCAAmC,EAAE,GAAG,CAAC,CAAC;gBACvD,CAAC,CAAC,CAAC;aACF;iBAAM;gBACP,EAAE,CAAC,GAAG,CAAC,uDAAuD,CAAC,CAAC;aAC/D;QACL,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,GAAQ;YACd,EAAE,CAAC,KAAK,CAAC,oCAAoC,EAAE,GAAG,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,qCAAe,GAAtB;QACI,IAAM,KAAK,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACrD,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC;aACd,IAAI,CAAC,UAAC,QAAa;YACpB,IAAM,IAAI,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAC5B,IAAI,CAAC,IAAI,EAAE;gBACP,EAAE,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;gBAChC,OAAO;aACV;YAED,IAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;iBAC7B,IAAI,CAAC,UAAC,CAAM,EAAE,CAAM,IAAK,OAAA,CAAC,CAAC,YAAY,GAAG,CAAC,CAAC,YAAY,EAA/B,CAA+B,CAAC;iBACzD,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAElB,MAAM,CAAC,OAAO,CAAC,UAAC,KAAU,EAAE,KAAa;gBACrC,EAAE,CAAC,GAAG,CAAC,OAAI,KAAK,GAAG,CAAC,UAAI,KAAK,CAAC,QAAQ,gBAAW,KAAK,CAAC,YAAc,CAAC,CAAC;YAC3E,CAAC,CAAC,CAAC;QACH,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,GAAQ;YAChB,EAAE,CAAC,KAAK,CAAC,gDAAgD,EAAE,GAAG,CAAC,CAAC;QAChE,CAAC,CAAC,CAAC;IACX,CAAC;IAnXD;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,SAAS,EAAE,CAAC;4CACD;IAGhC;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;mDACgB;IALlB,WAAW;QAD/B,OAAO;OACa,WAAW,CAsX/B;IAAD,kBAAC;CAtXD,AAsXC,CAtXwC,EAAE,CAAC,SAAS,GAsXpD;kBAtXoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport LoadingManager from \"./Menu/LoadingManager\";\r\ndeclare const firebase: any;\r\n//for Firebase initialization\r\ndeclare global {\r\n    interface Window {\r\n        _firebaseInited?: boolean;\r\n    }\r\n}\r\n\r\n@ccclass\r\nexport default class GameManager extends cc.Component {\r\n    @property({ type: cc.AudioClip })\r\n    public bgm: cc.AudioClip = null;\r\n\r\n    @property(cc.Label)\r\n    public LevelLabel: cc.Label = null;\r\n\r\n    private maxhp: number = 10;\r\n    private player: cc.Node = null;\r\n    public VolumnValue : number = null;\r\n    public Level: number = 1;\r\n\r\n    onLoad(){\r\n        let pauseBtnNode = cc.find(\"Canvas/Main Camera/UI/Pause\"); \r\n        if (pauseBtnNode) {\r\n            let PauseButton = new cc.Component.EventHandler();\r\n            PauseButton.target = this.node;\r\n            PauseButton.component = \"GameManager\";\r\n            PauseButton.handler = \"PauseGame\";\r\n            pauseBtnNode.getComponent(cc.Button).clickEvents.push(PauseButton);\r\n        } else {\r\n            cc.error(\"Pause 按鈕節點找不到，請檢查 Canvas/Main Camera/UI/Pause 是否存在！\");\r\n        }\r\n        // Initialize the level label\r\n        this.LevelLabel = cc.find(\"Canvas/Main Camera/UI/Level\").getComponent(cc.Label);\r\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \" + this.Level;\r\n        else cc.error(\"Level label not found\");\r\n\r\n        this.player = cc.find(\"Canvas/MapManager/Actors/Player\");\r\n\r\n        //assign blank space for next level\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.log(\"Is Firebase initialized?\", window._firebaseInited);\r\n\r\n        /*const firebaseConfig = {\r\n            apiKey: \"AIzaSyDFW4-emWdI1ghgZWWGp1wqoWvAvTwAqrQ\",\r\n            authDomain: \"rune-raids.firebaseapp.com\",\r\n            projectId: \"rune-raids\",\r\n            storageBucket: \"rune-raids.firebasestorage.app\",\r\n            messagingSenderId: \"530514360843\",\r\n            appId: \"1:530514360843:web:1cdda9d72bb4b52932250e\",\r\n            measurementId: \"G-B1C5FG1YSN\"\r\n        };*/\r\n\r\n        if (!window._firebaseInited) {\r\n            firebase.initializeApp(firebaseConfig);\r\n            window._firebaseInited = true;\r\n            cc.log(\"✅ Firebase initialized in GameManager.ts\");\r\n        } else {\r\n            cc.log(\"ℹ️ Firebase already initialized\");\r\n        }\r\n        \r\n    }\r\n\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        if (event.keyCode === cc.macro.KEY.space) {\r\n            this.GoNextLevel();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        cc.director.getCollisionManager().enabled = true;\r\n        \r\n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\r\n        if (savedVolumn!==null) this.VolumnValue = Number(savedVolumn);\r\n        else this.VolumnValue = 0.5;\r\n        cc.audioEngine.setEffectsVolume(this.VolumnValue);\r\n        cc.audioEngine.setMusicVolume(this.VolumnValue);\r\n        this.playMusic();\r\n        this.startGame();\r\n\r\n    }\r\n\r\n    PauseGame() {\r\n        console.log(\"Pause prefab load\");\r\n        //Pausesetting is a prefab\r\n        cc.resources.load(\"prefabs/PauseSetting\", cc.Prefab, (err, prefab) => {\r\n            if (err) {\r\n                cc.error(\"Failed to load PauseSetting prefab:\", err);\r\n                return;\r\n            }\r\n            \r\n            const PauseNode = cc.instantiate(prefab);\r\n            const Canvas = cc.find(\"Canvas\");\r\n            Canvas.addChild(PauseNode);\r\n            PauseNode.name = \"PauseSetting\";\r\n\r\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\r\n            if (cameraNode) {\r\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\r\n                PauseNode.setPosition(localPos);\r\n            } else {\r\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\r\n                PauseNode.setPosition(0, 0);\r\n            }\r\n\r\n            PauseNode.scaleX = 1;\r\n            PauseNode.scaleY = 1;\r\n            //Pause the game，停止鍵盤事件\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            cc.director.getScheduler().setTimeScale(0);\r\n            cc.director.getPhysicsManager().enabled = false;\r\n            let Canvas = cc.find(\"Canvas\");\r\n            this.PauseAllAnimation(Canvas); \r\n            this.initPause();\r\n        })\r\n        console.log(\"Pause prefab load...\");\r\n\r\n    }\r\n    initPause() {\r\n        //Resume button\r\n        let ResumeButton = new cc.Component.EventHandler();\r\n        ResumeButton.target = this.node;\r\n        ResumeButton.component = \"GameManager\";\r\n        ResumeButton.handler = \"ResumeGame\";\r\n        cc.find(\"Canvas/PauseSetting/Resume\").getComponent(cc.Button).clickEvents.push(ResumeButton);\r\n        //Volumn slider\r\n        let VolumnSlider = cc.find(\"Canvas/PauseSetting/Volumn/VolumnSlider\").getComponent(cc.Slider);\r\n        let savedVolumn = cc.sys.localStorage.getItem(\"VolumnValue\");\r\n        if (savedVolumn !== null) VolumnSlider.progress= Number(savedVolumn);\r\n        else VolumnSlider.progress = 0.5;\r\n        VolumnSlider.node.on('slide', this.onVolumnChange, this);\r\n        //Restart button\r\n        let RestartButton = new cc.Component.EventHandler();\r\n        RestartButton.target = this.node;\r\n        RestartButton.component = \"GameManager\";\r\n        RestartButton.handler = \"RestartGame\";\r\n        cc.find(\"Canvas/PauseSetting/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\r\n        //\r\n        let DescButton = new cc.Component.EventHandler();\r\n        DescButton.target = this.node;\r\n        DescButton.component = \"GameManager\";\r\n        DescButton.handler = \"showDesc\";\r\n        cc.find(\"Canvas/PauseSetting/How\").getComponent(cc.Button).clickEvents.push(DescButton);\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = false;\r\n        let ExitDescButton = new cc.Component.EventHandler();\r\n        ExitDescButton.target = this.node;\r\n        ExitDescButton.component = \"GameManager\";\r\n        ExitDescButton.handler = \"HideDesc\";\r\n        cc.find(\"Canvas/PauseSetting/Description/Exit\").getComponent(cc.Button).clickEvents.push(ExitDescButton);\r\n    }\r\n    HideDesc() {\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = false;\r\n    }\r\n    showDesc() {\r\n        let Desc = cc.find(\"Canvas/PauseSetting/Description\");\r\n        Desc.active = true;\r\n    }\r\n    RestartGame() {//Restart the game => back to menu\r\n        cc.director.getScheduler().setTimeScale(1);\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        let Canvas = cc.find(\"Canvas\");\r\n        this.ResumeAllAnimation(Canvas);    \r\n        cc.director.loadScene(\"Loading\", () => {\r\n            let loadingManager = cc.find(\"Canvas/LoadingManager\").getComponent(\"LoadingManager\");\r\n            loadingManager.startLoading(\"menu\");\r\n        });\r\n        //Destroy Pausetting node if it exists\r\n        //let PauseSettingNode = cc.find(\"Canvas/Pausetting\");\r\n        //if (PauseSettingNode) PauseSettingNode.destroy();\r\n        //else cc.error(\"PauseSetting node not found\");\r\n         \r\n    }\r\n    ResumeGame() {\r\n        let PauseSettingNode = cc.find(\"Canvas/PauseSetting\");\r\n        if (PauseSettingNode) PauseSettingNode.destroy();\r\n        else cc.error(\"PauseSetting node not found\");\r\n        //Resume the game\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.director.getScheduler().setTimeScale(1);\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        let Canvas = cc.find(\"Canvas\");\r\n        this.ResumeAllAnimation(Canvas); \r\n    }\r\n    onVolumnChange(slider: cc.Slider){\r\n        cc.audioEngine.setMusicVolume(slider.progress); // 0~1\r\n        cc.audioEngine.setEffectsVolume(slider.progress);\r\n        this.VolumnValue = slider.progress;\r\n        cc.sys.localStorage.setItem(\"VolumnValue\", this.VolumnValue.toString());\r\n    }\r\n    PauseAllAnimation(node: cc.Node) {\r\n        let anims = node.getComponentsInChildren(cc.Animation);\r\n        for (let anim of anims) {\r\n            if (anim) anim.pause();\r\n            else  cc.error(\"Animation component not found on node:\", node.name);\r\n        }\r\n        let children = node.children;\r\n        for (let child of children) this.PauseAllAnimation(child);\r\n    }\r\n    ResumeAllAnimation(node: cc.Node) {\r\n        let anims = node.getComponentsInChildren(cc.Animation);\r\n        for (let anim of anims) {\r\n            if (anim) anim.resume();\r\n            else  cc.error(\"Animation component not found on node:\", node.name);\r\n        }\r\n        let children = node.children;\r\n        for (let child of children) this.ResumeAllAnimation(child);\r\n    }\r\n\r\n    playMusic() {\r\n        if (this.bgm) cc.audioEngine.playMusic(this.bgm, true);\r\n        else cc.error(\"BGM not assigned!\");\r\n    }\r\n\r\n    pauseMusic() {\r\n        cc.audioEngine.pauseMusic();\r\n    }\r\n\r\n    resumeMusic() {\r\n        cc.audioEngine.resumeMusic();\r\n    }\r\n    public startGame(){\r\n        //Initialize the game state\r\n        this.Level = 1;\r\n        if (this.LevelLabel) this.LevelLabel.string = \"Level: \"+ this.Level;\r\n        else cc.error(\"Level Label not found\");\r\n        //set player position\r\n        this.player.getComponent(\"Player\").SetPlayer(this.Level);\r\n        //set Map\r\n        let GenMap = cc.find(\"GameManager\").getComponent(\"MapGenerator\");\r\n        GenMap.GeneratorMap();\r\n        //set monster\r\n        let MonsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\").getComponent(\"MonsterManager\");\r\n        MonsterMgr.SetMonster(this.Level);\r\n\r\n    }\r\n\r\n    public GoNextLevel() {\r\n        this.Level++;\r\n        this.saveProgress(this.Level);\r\n\r\n        if (this.LevelLabel) {\r\n            this.LevelLabel.string = \"Level: \" + this.Level;\r\n        } else {\r\n            cc.error(\"Level label not found\");\r\n        }\r\n\r\n        // regenerate the map\r\n        const mapGen = cc.find(\"GameManager\")?.getComponent(\"MapGenerator\");\r\n        if (mapGen) {\r\n            mapGen.regenerateMap(this.Level);\r\n        } else {\r\n            cc.error(\"MapGenerator component not found\");\r\n        }\r\n\r\n        // reset player position\r\n        const playerComp = this.player?.getComponent(\"Player\");\r\n        if (playerComp) {\r\n            playerComp.SetPlayer(this.Level);\r\n        } else {\r\n            cc.error(\"Player component not found\");\r\n        }\r\n\r\n        // reset monster\r\n        const monsterMgr = cc.find(\"Canvas/MapManager/MonsterManager\")?.getComponent(\"MonsterManager\");\r\n        if (monsterMgr) {\r\n            monsterMgr.SetMonster(this.Level);\r\n        }\r\n\r\n        // adjust camera zoom and UI scaling\r\n        const camera = cc.find(\"Canvas/Main Camera\")?.getComponent(cc.Camera);\r\n        if (camera) {\r\n            camera.zoomRatio *= 0.99;\r\n\r\n            const UI = cc.find(\"Canvas/Main Camera/UI\");\r\n            if (UI) {\r\n                UI.setPosition(0, 0);\r\n                UI.scaleX = 1 / camera.zoomRatio;\r\n                UI.scaleY = 1 / camera.zoomRatio;\r\n            } else {\r\n                cc.log(\"UI not found\");\r\n            }\r\n        }\r\n    }\r\n    public EndGame() {\r\n        cc.resources.load(\"prefabs/GameOver\", cc.Prefab, (err, prefab) => {\r\n            if (err) {\r\n                cc.error(\"Failed to load GameOver prefab:\", err);\r\n                return;\r\n            }\r\n            const GameOverNode = cc.instantiate(prefab);\r\n            const Canvas = cc.find(\"Canvas\");\r\n            Canvas.addChild(GameOverNode,1,'GameOver');\r\n            //視窗正中間\r\n            let cameraNode = cc.find(\"Canvas/Main Camera\");\r\n            if (cameraNode) {\r\n                let worldPos = cameraNode.convertToWorldSpaceAR(cc.Vec2.ZERO);\r\n                let localPos = Canvas.convertToNodeSpaceAR(worldPos);\r\n                GameOverNode.setPosition(localPos);\r\n            } else {\r\n                cc.warn(\"找不到 Main Camera, 使用預設位置 (0, 0)\");\r\n                GameOverNode.setPosition(0, 0);\r\n            }\r\n            let RestartButton = new cc.Component.EventHandler();\r\n        RestartButton.target = this.node;\r\n        RestartButton.component = \"GameManager\";\r\n        RestartButton.handler = \"RestartGame\";\r\n        cc.find(\"Canvas/GameOver/Restart\").getComponent(cc.Button).clickEvents.push(RestartButton);\r\n\r\n        let end = cc.find(\"Canvas/GameOver/player\").getComponent(cc.Animation);\r\n        //game over animation\r\n        this.scheduleOnce(()=>{ \r\n            end.play(\"gameover\");\r\n        });\r\n        });\r\n        \r\n    }\r\n    private saveProgress(level: number) {\r\n        cc.log(\"Saving progress for level:\", level);\r\n\r\n        if (!window._firebaseInited) {\r\n            cc.warn(\"Firebase not initialized.\");\r\n            return;\r\n        }\r\n\r\n        const user = firebase.auth().currentUser;\r\n        if (!user) {\r\n            cc.warn(\"User not logged in.\");\r\n            return;\r\n        }\r\n\r\n        const userRef = firebase.database().ref(\"leaderboard/\" + user.uid);\r\n\r\n        userRef.once(\"value\").then((snapshot: any) => {\r\n            const existing = snapshot.val();\r\n            const previousLevel = existing?.highestLevel || 0;\r\n\r\n            if (level > previousLevel) {\r\n            userRef.set({\r\n                username: user.displayName || \"Unknown\",\r\n                highestLevel: level,\r\n                lastUpdate: firebase.database.ServerValue.TIMESTAMP\r\n            }).then(() => {\r\n                cc.log(`✅ Updated Realtime DB for ${user.displayName || \"Unknown\"}: Level ${level}`);\r\n            }).catch((err: any) => {\r\n                cc.error(\"❌ Failed to write to Realtime DB:\", err);\r\n            });\r\n            } else {\r\n            cc.log(\"No update needed — previous level is higher or equal.\");\r\n            }\r\n        }).catch((err: any) => {\r\n            cc.error(\"❌ Failed to read from Realtime DB:\", err);\r\n        });\r\n    }\r\n\r\n    public loadLeaderboard() {\r\n        const dbRef = firebase.database().ref(\"leaderboard\");\r\n        dbRef.once(\"value\")\r\n            .then((snapshot: any) => {\r\n            const data = snapshot.val();\r\n            if (!data) {\r\n                cc.log(\"Leaderboard is empty.\");\r\n                return;\r\n            }\r\n\r\n            const sorted = Object.values(data)\r\n                .sort((a: any, b: any) => b.highestLevel - a.highestLevel)\r\n                .slice(0, 10);\r\n\r\n            sorted.forEach((entry: any, index: number) => {\r\n                cc.log(`#${index + 1} ${entry.username}: Level ${entry.highestLevel}`);\r\n            });\r\n            })\r\n            .catch((err: any) => {\r\n            cc.error(\"❌ Failed to load leaderboard from Realtime DB:\", err);\r\n            });\r\n    }\r\n}"]}
>>>>>>> parent of e74437c (Merge branch 'master' of https://github.com/angelineaurelia/rune-raides)
