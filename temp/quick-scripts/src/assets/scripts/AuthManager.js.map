{"version":3,"sources":["assets/scripts/AuthManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// AuthManager.ts\ndeclare const firebase: any;\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class AuthManager extends cc.Component {\n  @property(cc.EditBox)    emailInput: cc.EditBox = null;\n  @property(cc.EditBox) usernameInput: cc.EditBox = null;\n  @property(cc.EditBox) passwordInput: cc.EditBox = null;\n  @property(cc.Node) loginCanvas: cc.Node = null;\n  @property(cc.Node) menuRoot: cc.Node = null;\n\n  private auth: any = null;\n\n  onLoad() {\n    const firebaseConfig = {\n      apiKey: \"AIzaSyDFW4-emWdI1ghgZWWGp1wqoWvAvTwAqrQ\",\n      authDomain: \"rune-raids.firebaseapp.com\",\n      projectId: \"rune-raids\",\n      storageBucket: \"rune-raids.firebasestorage.app\",\n      messagingSenderId: \"530514360843\",\n      appId: \"1:530514360843:web:1cdda9d72bb4b52932250e\",\n      measurementId: \"G-B1C5FG1YSN\"\n    };\n    if (!firebase.apps.length) {\n      firebase.initializeApp(firebaseConfig);\n      cc.log(\"Firebase initialized (v8)\");\n    }\n    this.auth = firebase.auth();\n  }\n\n  /** Called by “Sign Up” button in SignupLogin prefab */\n  public SignUp() {\n    const email = this.emailInput.string.trim();\n    const username = this.usernameInput.string.trim();\n    const password = this.passwordInput.string;\n\n    if (!email || !username || !password) {\n      cc.warn(\"Email, username, and password are all required.\");\n      return;\n    }\n\n    this.auth\n      .createUserWithEmailAndPassword(email, password)\n      .then((userCredential: any) => {\n        return userCredential.user.updateProfile({ displayName: username });\n      })\n      .then(() => {\n        cc.log(\"Sign-up successful:\", username);\n        this.showSuccessPopup(\"Sign-up Successful\");\n      })\n      .catch((err: any) => {\n        cc.error(\"SignUp error:\", err);\n      });\n  }\n\n  public Login() {\n    const email = this.emailInput.string.trim();\n    const password = this.passwordInput.string;\n\n    if (!email || !password) {\n      cc.warn(\"Email and password are required.\");\n      return;\n    }\n\n    this.auth\n      .signInWithEmailAndPassword(email, password)\n      .then((userCredential: any) => {\n        cc.log(\"Login successful:\", userCredential.user.displayName);\n        this.showSuccessPopup(\"Login Successful\");\n      })\n      .catch((err: any) => {\n        cc.error(\"Login error:\", err);\n      });\n  }\n\n  private showSuccessPopup(msg: string) {\n    cc.resources.load(\"prefabs/SuccessPopup\", cc.Prefab, (err, prefab) => {\n      if (err) {\n        cc.error(\"Failed to load SuccessPopup prefab:\", err);\n        return;\n      }\n      const popupNode = cc.instantiate(prefab);\n      popupNode.setPosition(0, 0);\n      popupNode.zIndex = 2000; // make sure it sits on top\n      cc.find(\"Canvas\").addChild(popupNode);\n\n      // Get the SuccessPopup component so we can set text & callback\n      const popupComp = popupNode.getComponent(\"SuccessPopup\") as any;\n      popupComp.messageLabel.string = msg;\n\n      // When “OK” is clicked inside the popup:\n      popupComp.onOk = () => {\n        // 1) Hide/destroy the signup/login UI\n        this.loginCanvas.active = false;     // Or: this.loginCanvas.destroy();\n        // 2) Return to the base Menu––enable Start Game button:\n        this.menuRoot.getComponent(\"MenuMgr\")?.enableStartButton();\n      };\n    });\n  }\n}\n"]}