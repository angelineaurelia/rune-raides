{"version":3,"sources":["assets/scripts/LeaderboardManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uCAAuC;AAC/B,IAAA,OAAO,GAAK,EAAE,CAAC,UAAU,QAAlB,CAAmB;AAIlC;IAAgD,sCAAY;IAA5D;;IAoDA,CAAC;IAlDC,mCAAM,GAAN;QACE,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;YAC3B,EAAE,CAAC,KAAK,CAAC,iFAAiF,CAAC,CAAC;YAC5F,OAAO;SACR;IACH,CAAC;IAED,yCAAyC;IAClC,yCAAY,GAAnB,UAAoB,KAAa;QAC/B,IAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC;QACzC,IAAI,CAAC,IAAI,EAAE;YACT,EAAE,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;YAChE,OAAO;SACR;QAED,IAAM,EAAE,GAAG,QAAQ,CAAC,SAAS,EAAE,CAAC;QAChC,IAAM,OAAO,GAAG,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAE3D,OAAO,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,UAAA,GAAG;YACpB,IAAM,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;YACtD,IAAI,KAAK,GAAG,IAAI,EAAE;gBAChB,OAAO,CAAC,GAAG,CAAC;oBACV,QAAQ,EAAE,IAAI,CAAC,WAAW,IAAI,SAAS;oBACvC,YAAY,EAAE,KAAK;iBACpB,CAAC,CAAC;gBACH,EAAE,CAAC,GAAG,CAAC,0BAAwB,IAAI,CAAC,WAAW,kBAAa,KAAO,CAAC,CAAC;aACtE;QACH,CAAC,CAAC,CAAC,KAAK,CAAC,UAAA,GAAG;YACV,EAAE,CAAC,KAAK,CAAC,8BAA8B,EAAE,GAAG,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACL,CAAC;IAED,iEAAiE;IAC1D,4CAAe,GAAtB,UAAuB,KAAkB;QAAlB,sBAAA,EAAA,UAAkB;QACvC,IAAM,EAAE,GAAG,QAAQ,CAAC,SAAS,EAAE,CAAC;QAChC,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC;aACzB,OAAO,CAAC,cAAc,EAAE,MAAM,CAAC;aAC/B,KAAK,CAAC,KAAK,CAAC;aACZ,GAAG,EAAE;aACL,IAAI,CAAC,UAAA,QAAQ;YACZ,QAAQ,CAAC,OAAO,CAAC,UAAA,GAAG;gBAClB,IAAM,IAAI,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;gBACxB,EAAE,CAAC,GAAG,CAAI,IAAI,CAAC,QAAQ,gBAAW,IAAI,CAAC,YAAc,CAAC,CAAC;gBACvD,yDAAyD;YAC3D,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;aACD,KAAK,CAAC,UAAA,GAAG;YACR,EAAE,CAAC,KAAK,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;IACP,CAAC;IAnDkB,kBAAkB;QADtC,OAAO;OACa,kBAAkB,CAoDtC;IAAD,yBAAC;CApDD,AAoDC,CApD+C,EAAE,CAAC,SAAS,GAoD3D;kBApDoB,kBAAkB","file":"","sourceRoot":"/","sourcesContent":["// assets/scripts/LeaderboardManager.ts\nconst { ccclass } = cc._decorator;\ndeclare const firebase: any;\n\n@ccclass\nexport default class LeaderboardManager extends cc.Component {\n\n  onLoad() {\n    if (!window._firebaseInited) {\n      cc.error(\"Firebase not initialized. Make sure FirebaseInit.ts is in the scene and active.\");\n      return;\n    }\n  }\n\n  // Call this when player finishes a level\n  public saveProgress(level: number) {\n    const user = firebase.auth().currentUser;\n    if (!user) {\n      cc.warn(\"No logged-in user; cannot save leaderboard progress.\");\n      return;\n    }\n\n    const db = firebase.firestore();\n    const userRef = db.collection(\"leaderboard\").doc(user.uid);\n\n    userRef.get().then(doc => {\n      const prev = doc.exists ? doc.data().highestLevel : 0;\n      if (level > prev) {\n        userRef.set({\n          username: user.displayName || \"Unknown\",\n          highestLevel: level\n        });\n        cc.log(`Progress updated for ${user.displayName} to level ${level}`);\n      }\n    }).catch(err => {\n      cc.error(\"Error accessing leaderboard:\", err);\n    });\n  }\n\n  // Call this to display top players (e.g., in leaderboard screen)\n  public loadLeaderboard(limit: number = 10) {\n    const db = firebase.firestore();\n    db.collection(\"leaderboard\")\n      .orderBy(\"highestLevel\", \"desc\")\n      .limit(limit)\n      .get()\n      .then(snapshot => {\n        snapshot.forEach(doc => {\n          const data = doc.data();\n          cc.log(`${data.username}: Level ${data.highestLevel}`);\n          // You can add logic here to populate your leaderboard UI\n        });\n      })\n      .catch(err => {\n        cc.error(\"Failed to load leaderboard:\", err);\n      });\n  }\n}\n"]}